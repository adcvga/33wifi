<title>%l10n_title_map%</title>

<head>
<script src="//api-maps.yandex.ru/2.1.74/?apikey=%var_ymaps_apikey%&lang=ru-RU" type="text/javascript"></script>
<script src="js/FileSaver.min.js" type="text/javascript"></script>
<script type="text/javascript">
function initmap()
{
	myMap = new ymaps.Map('map', {
		center: [%var_lat%, %var_lon%],
		zoom: 18,
		controls: ['geolocationControl','searchControl','typeSelector','fullscreenControl','zoomControl']
	}),

	baseTileUrl = '3wifi.php?a=map&tileNumber=%t&zoom=%z&clat=%var_lat%&clon=%var_lon%';
	var myTileUrl = baseTileUrl;

	var showaps = settingsGetBool('3wifi.map.showaps', true);
	var clusters = settingsGetBool('3wifi.map.clusters', true);
	var mob = isMobile();
	if (mob) myTileUrl += '&mobile=1';
	if (!clusters) myTileUrl += '&scat=1';

	remoteObjectManager = new ymaps.RemoteObjectManager(myTileUrl,
	{	// Разбивать запросы по тайлам
		splitRequests: false,
		// Опции кластеров задаются с префиксом cluster.
		clusterHasBalloon: false,
		clusterHasHint: !mob,
		// Опции объектов задаются с префиксом geoObject
		geoObjectOpenBalloonOnClick: mob
	});

	userLocations = new ymaps.RemoteObjectManager('user.php?a=mylocmap&bbox=%b' + (mob ? '&mobile=1' : ''),
	{	// Разбивать запросы по тайлам
		splitRequests: false,
		// Опции объектов задаются с префиксом geoObject
		geoObjectOpenBalloonOnClick: mob
	});

	if (ProfileInfo.Level >= 1)
		myMap.geoObjects.add(userLocations);

	if (showaps) myMap.geoObjects.add(remoteObjectManager);

	// Кнопка скрытия/показа точек доступа
	var iconShowAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGlkPSJzdmdfMSIgZD0ibS02MTIsMzIwbDAsOTZsOTYsMGwwLC05NmwtOTYsMHptODMsODNsLTcwLDBsMCwtNzBsNzAsMGwwLDcweiIvPgogIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTcuMzQwNDQ2LDIuNzU5NjM4YzIuODczNTkyLC0wLjIwNjk1MSA1LjgxMzcxNiwwLjg2ODE4NSA3Ljg2NDYyNCwyLjg5MzEyNGMwLjI2ODczLDAuMjc2NjQgMC4yMzM2ODYsMC43NjA1NzEgLTAuMDQ5ODIzLDEuMDE0MDkyYy0wLjI2MDM5MiwwLjMwNjk2NCAtMC43ODE4NDcsMC4zMTIzOSAtMS4wNTA1NzksMC4wMTMzNjljLTEuNzU0NDYsLTEuNjg5MDYzIC00LjIzMTU2MywtMi42MDI0MDkgLTYuNjYzODQzLC0yLjQyMDc1M2MtMi4wMjA2MTUsMC4xMjk5OTcgLTMuOTc4MDQxLDEuMDAwMzU5IC01LjQ0NDI3MiwyLjM5NDM4NmMtMC4xMzAzOTUsMC4xMzMyNzYgLTAuMjk2OTA2LDAuMjQyNzAxIC0wLjQ4ODY1MSwwLjI1MjA4MWMtMC40ODAzMTEsMC4wNTYzMjMgLTAuOTI0NTA2LC0wLjQ0NTY2NCAtMC44MjA4NDYsLTAuOTE1NDkyYzAuMDI5MjQ5LC0wLjE2ODY1OCAwLjEzNzU2OSwtMC4zMDkxMzkgMC4yNjE0MzQsLTAuNDIxNDc2YzEuNzE2NTY0LC0xLjY0MzU2NCA0LjAyMTAyNCwtMi42NTI5NjcgNi4zOTE5NTYsLTIuODA5MzMxeiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z18zIiBkPSJtNy4yNjkzMTYsNS41Nzc2NDVjMi4yMDE1MzgsLTAuMjM5NDUxIDQuNDg3NiwwLjU3MjA0NiA2LjA0NTUzMywyLjE0NTE4NmMwLjI0MzQwNCwwLjI3ODA4MiAwLjIxMzA4NCwwLjczMjc5MyAtMC4wNTczOTQsMC45ODI2OThjLTAuMjQ2Njg3LDAuMzAxOTAzIC0wLjc0Mzk1MywwLjMzNTgxMiAtMS4wMjM1MDcsMC4wNjIwNTRjLTAuOTk3NDc3LC0wLjk4MzM3NSAtMi4zNDYwMDQsLTEuNjA3Nzg0IC0zLjc0NDMyNCwtMS43MTAwMDRjLTEuNjk4MTM2LC0wLjE0MDg0OSAtMy40MzMwNjYsMC41MDM0MjkgLTQuNjQyMTg2LDEuNjk5OTE4Yy0wLjI3ODgxNiwwLjI5NDY5OSAtMC43OTgxNTgsMC4yNjExNTcgLTEuMDQ5MTA2LC0wLjA1MjM2NmMtMC4yNzA1MDksLTAuMjU1MzAyIC0wLjI5Mjg5MSwtMC43MjIzMDggLTAuMDMzMjM1LC0wLjk5Mjc4N2MxLjE5ODI5NywtMS4xOTg5NyAyLjgxODc0MywtMS45NjE3MTcgNC41MDQyMTksLTIuMTM0Njk4eiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z180IiBkPSJtNy41OTQ3MDYsOC4zNTgwOTRjMS4zODkzMDMsLTAuMTM3OTM4IDIuODI1NjEsMC4zOTQwMzcgMy43OTIzNjYsMS40MDAxODhjMC4yNjQ3MTQsMC4yNzU1MzggMC4yMzQwNTQsMC43NDk3NDggLTAuMDQ0NzkzLDEuMDA0NzEzYy0wLjI1MzE1NiwwLjMwNTU1MiAtMC43NjA1NzEsMC4zMjYxNTYgLTEuMDM1NzQsMC4wMzk3MzRjLTAuNTQ0OTQzLC0wLjU1OTM4MSAtMS4yOTk3ODEsLTAuOTEyOTc3IC0yLjA4MTI5MiwtMC45NTU1OTRjLTAuODg2OTQ3LC0wLjA2MzIyIC0xLjc4NDQxMiwwLjI4NzEyNSAtMi40MTQyNTEsMC45MTA0MzNjLTAuMTU0OTIyLDAuMTc0MTE2IC0wLjM4NDk5LDAuMjgwOTk0IC0wLjYyMDQ1NiwwLjI1MzIxN2MtMC41NDY3NTEsLTAuMDM4MzIzIC0wLjkyNjMxNSwtMC43NjgyMDMgLTAuNTQ5NjYzLC0xLjIwNjI2N2MwLjc2MDU3LC0wLjgyNDg2MiAxLjg0MDc2NiwtMS4zMzU4OTUgMi45NTM4MjksLTEuNDQ2NDI0eiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z181IiBkPSJtNy44MDg4NjIsMTAuOTU0MzcxYzAuODk1Mjg3LC0wLjE1MDIyOSAxLjgwMzkxMiwwLjU4OTA2NSAxLjgzMjgyNCwxLjQ5NjkyMmMwLjA4MzA1NiwwLjg5MDIyNyAtMC43MDI4MDcsMS43MzQ5OSAtMS41OTYyMjYsMS43MTU0MjljLTAuODAzMTg2LDAuMDI3ODM4IC0xLjU0NzUzOSwtMC42Mzg0ODIgLTEuNjE3OTYyLC0xLjQzNzMxN2MtMC4xMTQ1MTMsLTAuODM4NiAwLjU0MTMyMywtMS42NzgyNDEgMS4zODEzNjQsLTEuNzc1MDM0eiIgZmlsbD0iIzAwMDAwMCIvPgogPC9nPgo8L3N2Zz4=';
	var iconHideAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGlkPSJzdmdfMSIgZD0ibS02MTIsMzIwbDAsOTZsOTYsMGwwLC05NmwtOTYsMHptODMsODNsLTcwLDBsMCwtNzBsNzAsMGwwLDcweiIvPgogIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTcuMzQwNDQ2LDIuNzU5NjM4YzIuODczNTkyLC0wLjIwNjk1MSA1LjgxMzcxNiwwLjg2ODE4NSA3Ljg2NDYyNCwyLjg5MzEyNGMwLjI2ODczLDAuMjc2NjQgMC4yMzM2ODYsMC43NjA1NzEgLTAuMDQ5ODIzLDEuMDE0MDkyYy0wLjI2MDM5MiwwLjMwNjk2NCAtMC43ODE4NDcsMC4zMTIzOSAtMS4wNTA1NzksMC4wMTMzNjljLTEuNzU0NDYsLTEuNjg5MDYzIC00LjIzMTU2MywtMi42MDI0MDkgLTYuNjYzODQzLC0yLjQyMDc1M2MtMi4wMjA2MTUsMC4xMjk5OTcgLTMuOTc4MDQxLDEuMDAwMzU5IC01LjQ0NDI3MiwyLjM5NDM4NmMtMC4xMzAzOTUsMC4xMzMyNzYgLTAuMjk2OTA2LDAuMjQyNzAxIC0wLjQ4ODY1MSwwLjI1MjA4MWMtMC40ODAzMTEsMC4wNTYzMjMgLTAuOTI0NTA2LC0wLjQ0NTY2NCAtMC44MjA4NDYsLTAuOTE1NDkyYzAuMDI5MjQ5LC0wLjE2ODY1OCAwLjEzNzU2OSwtMC4zMDkxMzkgMC4yNjE0MzQsLTAuNDIxNDc2YzEuNzE2NTY0LC0xLjY0MzU2NCA0LjAyMTAyNCwtMi42NTI5NjcgNi4zOTE5NTYsLTIuODA5MzMxeiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z18zIiBkPSJtNy4yNjkzMTYsNS41Nzc2NDVjMi4yMDE1MzgsLTAuMjM5NDUxIDQuNDg3NiwwLjU3MjA0NiA2LjA0NTUzMywyLjE0NTE4NmMwLjI0MzQwNCwwLjI3ODA4MiAwLjIxMzA4NCwwLjczMjc5MyAtMC4wNTczOTQsMC45ODI2OThjLTAuMjQ2Njg3LDAuMzAxOTAzIC0wLjc0Mzk1MywwLjMzNTgxMiAtMS4wMjM1MDcsMC4wNjIwNTRjLTAuOTk3NDc3LC0wLjk4MzM3NSAtMi4zNDYwMDQsLTEuNjA3Nzg0IC0zLjc0NDMyNCwtMS43MTAwMDRjLTEuNjk4MTM2LC0wLjE0MDg0OSAtMy40MzMwNjYsMC41MDM0MjkgLTQuNjQyMTg2LDEuNjk5OTE4Yy0wLjI3ODgxNiwwLjI5NDY5OSAtMC43OTgxNTgsMC4yNjExNTcgLTEuMDQ5MTA2LC0wLjA1MjM2NmMtMC4yNzA1MDksLTAuMjU1MzAyIC0wLjI5Mjg5MSwtMC43MjIzMDggLTAuMDMzMjM1LC0wLjk5Mjc4N2MxLjE5ODI5NywtMS4xOTg5NyAyLjgxODc0MywtMS45NjE3MTcgNC41MDQyMTksLTIuMTM0Njk4eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z180IiBkPSJtNy41OTQ3MDYsOC4zNTgwOTRjMS4zODkzMDMsLTAuMTM3OTM4IDIuODI1NjEsMC4zOTQwMzcgMy43OTIzNjYsMS40MDAxODhjMC4yNjQ3MTQsMC4yNzU1MzggMC4yMzQwNTQsMC43NDk3NDggLTAuMDQ0NzkzLDEuMDA0NzEzYy0wLjI1MzE1NiwwLjMwNTU1MiAtMC43NjA1NzEsMC4zMjYxNTYgLTEuMDM1NzQsMC4wMzk3MzRjLTAuNTQ0OTQzLC0wLjU1OTM4MSAtMS4yOTk3ODEsLTAuOTEyOTc3IC0yLjA4MTI5MiwtMC45NTU1OTRjLTAuODg2OTQ3LC0wLjA2MzIyIC0xLjc4NDQxMiwwLjI4NzEyNSAtMi40MTQyNTEsMC45MTA0MzNjLTAuMTU0OTIyLDAuMTc0MTE2IC0wLjM4NDk5LDAuMjgwOTk0IC0wLjYyMDQ1NiwwLjI1MzIxN2MtMC41NDY3NTEsLTAuMDM4MzIzIC0wLjkyNjMxNSwtMC43NjgyMDMgLTAuNTQ5NjYzLC0xLjIwNjI2N2MwLjc2MDU3LC0wLjgyNDg2MiAxLjg0MDc2NiwtMS4zMzU4OTUgMi45NTM4MjksLTEuNDQ2NDI0eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z181IiBkPSJtNy44MDg4NjIsMTAuOTU0MzcxYzAuODk1Mjg3LC0wLjE1MDIyOSAxLjgwMzkxMiwwLjU4OTA2NSAxLjgzMjgyNCwxLjQ5NjkyMmMwLjA4MzA1NiwwLjg5MDIyNyAtMC43MDI4MDcsMS43MzQ5OSAtMS41OTYyMjYsMS43MTU0MjljLTAuODAzMTg2LDAuMDI3ODM4IC0xLjU0NzUzOSwtMC42Mzg0ODIgLTEuNjE3OTYyLC0xLjQzNzMxN2MtMC4xMTQ1MTMsLTAuODM4NiAwLjU0MTMyMywtMS42NzgyNDEgMS4zODEzNjQsLTEuNzc1MDM0eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIGZpbHRlcj0idXJsKCNzdmdfN19ibHVyKSIgc3Ryb2tlPSJudWxsIiBpZD0ic3ZnXzciIGQ9Im0zLjQzNDc5OSwxMi4xODU1OThsOS43NzAzMDgsLTkuNzcwMzA5bDAuNzcwNzc2LDAuNzcwNzc2bC05Ljc3MDMwNyw5Ljc3MDMwOGwtMC43NzA3NzcsLTAuNzcwNzc1eiIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWRhc2hhcnJheT0ibnVsbCIgc3Ryb2tlLXdpZHRoPSJudWxsIiBmaWxsPSIjZTAwMjAyIi8+CiA8L2c+CiA8ZGVmcz4KICA8ZmlsdGVyIGhlaWdodD0iMjAwJSIgd2lkdGg9IjIwMCUiIHk9Ii01MCUiIHg9Ii01MCUiIGlkPSJzdmdfN19ibHVyIj4KICAgPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMC4zIiBpbj0iU291cmNlR3JhcGhpYyIvPgogIDwvZmlsdGVyPgogPC9kZWZzPgo8L3N2Zz4=';
	var showButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_show_aps%',
			image: (showaps ? iconShowAP : iconHideAP)
		},
		options: {
			float: 'right'
		},
		state: {
			selected: showaps
		}
	});
	showButton.events
		.add(
			'select',
			function () {
				settingsSetBool('3wifi.map.showaps', true);
				myMap.geoObjects.add(remoteObjectManager);
				showButton.data.set('image', iconShowAP);
			}
		)
		.add(
			'deselect',
			function () {
				settingsSetBool('3wifi.map.showaps', false);
				myMap.geoObjects.remove(remoteObjectManager);
				showButton.data.set('image', iconHideAP);
			}
		);
	myMap.controls.add(showButton);

	// Кнопка включения/выключения кластеризации
	var iconClustAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCA5NCA5NCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+DQogIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPg0KICAgIDxnIGlkPSJjbHVzdGVyX3M6MSIgc2tldGNoOnR5cGU9Ik1TQXJ0Ym9hcmRHcm91cCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTYuMDAwMDAwLCAtNS4wMDAwMDApIj4NCiAgICAgIDxyZWN0IGQ9Ik0wLDAgTDAsNTUgTDg0Niw1NSBMODQ2LDAgTDAsMCBaIE0wLDAiIGlkPSJiZyIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgeD0iMCIgeT0iMCIgd2lkdGg9Ijg0NiIgaGVpZ2h0PSI1NSI+PC9yZWN0Pg0KICAgICAgPGcgaWQ9ImJsdWUiIHNrZXRjaDp0eXBlPSJNU0xheWVyR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYuMDAwMDAwLCA1LjAwMDAwMCkiPg0KICAgICAgICA8Y2lyY2xlIGQ9Ik0yMyw0NiBDMzUuNzAyNTQ5OSw0NiA0NiwzNS43MDI1NDk5IDQ2LDIzIEM0NiwxMC4yOTc0NTAxIDM1LjcwMjU0OTksMCAyMywwIEMxMC4yOTc0NTAxLDAgMCwxMC4yOTc0NTAxIDAsMjMgQzAsMzUuNzAyNTQ5OSAxMC4yOTc0NTAxLDQ2IDIzLDQ2IFogTTIzLDQ2IiBpZD0iT3ZhbC0xLWNvcHkiIGZpbGwtb3BhY2l0eT0iMC44IiBmaWxsPSIjRkZGRkZGIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiBjeD0iMjMiIGN5PSIyMyIgcj0iMjMiPjwvY2lyY2xlPg0KICAgICAgICA8Y2lyY2xlIGQ9Ik0yMyw0NCBDMzQuNTk3OTgwMyw0NCA0NCwzNC41OTc5ODAzIDQ0LDIzIEM0NCwxMS40MDIwMTk3IDM0LjU5Nzk4MDMsMiAyMywyIEMxMS40MDIwMTk3LDIgMiwxMS40MDIwMTk3IDIsMjMgQzIsMzQuNTk3OTgwMyAxMS40MDIwMTk3LDQ0IDIzLDQ0IFogTTIzLDQ0IiBpZD0iT3ZhbC0xLWNvcHktMiIgZmlsbD0iIzFFOThGRiIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgY3g9IjIzIiBjeT0iMjMiIHI9IjIxIj48L2NpcmNsZT4NCiAgICAgICAgPGNpcmNsZSBkPSJNMjMsMzggQzMxLjI4NDI3MTcsMzggMzgsMzEuMjg0MjcxNyAzOCwyMyBDMzgsMTQuNzE1NzI4MyAzMS4yODQyNzE3LDggMjMsOCBDMTQuNzE1NzI4Myw4IDgsMTQuNzE1NzI4MyA4LDIzIEM4LDMxLjI4NDI3MTcgMTQuNzE1NzI4MywzOCAyMywzOCBaIE0yMywzOCIgaWQ9Ik92YWwtMS1jb3B5LTMiIGZpbGw9IiNGRkZGRkYiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIGN4PSIyMyIgY3k9IjIzIiByPSIxNSI+PC9jaXJjbGU+DQogICAgICA8L2c+DQogICAgPC9nPg0KICAgIDxnIGlkPSJjbHVzdGVyX3M6MiIgc2tldGNoOnR5cGU9Ik1TQXJ0Ym9hcmRHcm91cCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDQuMDAwMDAwLCA4LjAwMDAwMCkiPg0KICAgICAgPHJlY3QgZD0iTTAsMCBMMCw1NSBMODQ2LDU1IEw4NDYsMCBMMCwwIFogTTAsMCIgaWQ9ImJnIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiB4PSIwIiB5PSIwIiB3aWR0aD0iODQ2IiBoZWlnaHQ9IjU1Ij48L3JlY3Q+DQogICAgICA8ZyBpZD0iYmx1ZSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNi4wMDAwMDAsIDUuMDAwMDAwKSI+DQogICAgICAgIDxjaXJjbGUgZD0iTTIzLDQ2IEMzNS43MDI1NDk5LDQ2IDQ2LDM1LjcwMjU0OTkgNDYsMjMgQzQ2LDEwLjI5NzQ1MDEgMzUuNzAyNTQ5OSwwIDIzLDAgQzEwLjI5NzQ1MDEsMCAwLDEwLjI5NzQ1MDEgMCwyMyBDMCwzNS43MDI1NDk5IDEwLjI5NzQ1MDEsNDYgMjMsNDYgWiBNMjMsNDYiIGlkPSJPdmFsLTEtY29weSIgZmlsbC1vcGFjaXR5PSIwLjgiIGZpbGw9IiNGRkZGRkYiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIGN4PSIyMyIgY3k9IjIzIiByPSIyMyI+PC9jaXJjbGU+DQogICAgICAgIDxjaXJjbGUgZD0iTTIzLDQ0IEMzNC41OTc5ODAzLDQ0IDQ0LDM0LjU5Nzk4MDMgNDQsMjMgQzQ0LDExLjQwMjAxOTcgMzQuNTk3OTgwMywyIDIzLDIgQzExLjQwMjAxOTcsMiAyLDExLjQwMjAxOTcgMiwyMyBDMiwzNC41OTc5ODAzIDExLjQwMjAxOTcsNDQgMjMsNDQgWiBNMjMsNDQiIGlkPSJPdmFsLTEtY29weS0yIiBmaWxsPSIjMUU5OEZGIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiBjeD0iMjMiIGN5PSIyMyIgcj0iMjEiPjwvY2lyY2xlPg0KICAgICAgICA8Y2lyY2xlIGQ9Ik0yMywzOCBDMzEuMjg0MjcxNywzOCAzOCwzMS4yODQyNzE3IDM4LDIzIEMzOCwxNC43MTU3MjgzIDMxLjI4NDI3MTcsOCAyMyw4IEMxNC43MTU3MjgzLDggOCwxNC43MTU3MjgzIDgsMjMgQzgsMzEuMjg0MjcxNyAxNC43MTU3MjgzLDM4IDIzLDM4IFogTTIzLDM4IiBpZD0iT3ZhbC0xLWNvcHktMyIgZmlsbD0iI0ZGRkZGRiIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgY3g9IjIzIiBjeT0iMjMiIHI9IjE1Ij48L2NpcmNsZT4NCiAgICAgIDwvZz4NCiAgICA8L2c+DQogICAgPGcgaWQ9ImNsdXN0ZXJfczozIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4LjAwMDAwMCwgNDQuMDAwMDAwKSI+DQogICAgICA8cmVjdCBkPSJNMCwwIEwwLDU1IEw4NDYsNTUgTDg0NiwwIEwwLDAgWiBNMCwwIiBpZD0iYmciIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIHg9IjAiIHk9IjAiIHdpZHRoPSI4NDYiIGhlaWdodD0iNTUiPjwvcmVjdD4NCiAgICAgIDxnIGlkPSJibHVlIiBza2V0Y2g6dHlwZT0iTVNMYXllckdyb3VwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2LjAwMDAwMCwgNS4wMDAwMDApIj4NCiAgICAgICAgPGNpcmNsZSBkPSJNMjMsNDYgQzM1LjcwMjU0OTksNDYgNDYsMzUuNzAyNTQ5OSA0NiwyMyBDNDYsMTAuMjk3NDUwMSAzNS43MDI1NDk5LDAgMjMsMCBDMTAuMjk3NDUwMSwwIDAsMTAuMjk3NDUwMSAwLDIzIEMwLDM1LjcwMjU0OTkgMTAuMjk3NDUwMSw0NiAyMyw0NiBaIE0yMyw0NiIgaWQ9Ik92YWwtMS1jb3B5IiBmaWxsLW9wYWNpdHk9IjAuOCIgZmlsbD0iI0ZGRkZGRiIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgY3g9IjIzIiBjeT0iMjMiIHI9IjIzIj48L2NpcmNsZT4NCiAgICAgICAgPGNpcmNsZSBkPSJNMjMsNDQgQzM0LjU5Nzk4MDMsNDQgNDQsMzQuNTk3OTgwMyA0NCwyMyBDNDQsMTEuNDAyMDE5NyAzNC41OTc5ODAzLDIgMjMsMiBDMTEuNDAyMDE5NywyIDIsMTEuNDAyMDE5NyAyLDIzIEMyLDM0LjU5Nzk4MDMgMTEuNDAyMDE5Nyw0NCAyMyw0NCBaIE0yMyw0NCIgaWQ9Ik92YWwtMS1jb3B5LTIiIGZpbGw9IiMxRTk4RkYiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIGN4PSIyMyIgY3k9IjIzIiByPSIyMSI+PC9jaXJjbGU+DQogICAgICAgIDxjaXJjbGUgZD0iTTIzLDM4IEMzMS4yODQyNzE3LDM4IDM4LDMxLjI4NDI3MTcgMzgsMjMgQzM4LDE0LjcxNTcyODMgMzEuMjg0MjcxNyw4IDIzLDggQzE0LjcxNTcyODMsOCA4LDE0LjcxNTcyODMgOCwyMyBDOCwzMS4yODQyNzE3IDE0LjcxNTcyODMsMzggMjMsMzggWiBNMjMsMzgiIGlkPSJPdmFsLTEtY29weS0zIiBmaWxsPSIjRkZGRkZGIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiBjeD0iMjMiIGN5PSIyMyIgcj0iMTUiPjwvY2lyY2xlPg0KICAgICAgPC9nPg0KICAgIDwvZz4NCiAgPC9nPg0KPC9zdmc+';
	var iconScattAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KICA8c3R5bGU+LndoaXRlX29wYWNpdHl7ZmlsbDojZmZmO2ZpbGwtb3BhY2l0eTogMC44O30uY3VzdG9tX2NvbG9yX3NvbGlke2ZpbGw6IzFFOThGRjt9LndoaXRlX3NvbGlke2ZpbGw6I2ZmZjt9LmJsYWNrX3NvbGlkX3N0YXJ0LC5ibGFja19zb2xpZF9maW5pc2h7c3RvcC1jb2xvcjojMDAwO30uYmxhY2tfc29saWRfZmluaXNoe3N0b3Atb3BhY2l0eTogMDt9LnNoYWRvd3tvcGFjaXR5OiAwLjU7fTwvc3R5bGU+DQogIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIuMDAwMDAwLCAwLjAwMDAwMCkiPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0ic2hhZG93LWdyYWRpZW50MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSItNDQwLjk1NjUiIHkxPSI3MS42NzM4IiB4Mj0iLTQ0MC4wNTY1IiB5Mj0iNzAuODczOCIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgyMS4yMTYxIDAgMCAyMS43ODc5IDkzNjguNDg4MyAtMTUyNC41MzIyKSI+DQogICAgICA8c3RvcCBvZmZzZXQ9IjAiIGNsYXNzPSJibGFja19zb2xpZF9zdGFydCIgLz4NCiAgICAgIDxzdG9wIG9mZnNldD0iMSIgY2xhc3M9ImJsYWNrX3NvbGlkX2ZpbmlzaCIgLz4NCiAgICA8L2xpbmVhckdyYWRpZW50Pg0KICAgIDxwYXRoIGNsYXNzPSJzaGFkb3ciIGZpbGw9InVybCgjc2hhZG93LWdyYWRpZW50MikiIGQ9Ik0xMi43MTksMzkuN2M0LjcxMS0yLjM5NSwxNy44MTgtMTEuNTE4LDE4LjMwNC0xMS45NzljMC41NTMtMC41MjEsMS4wNjItMS4wNjIsMS40OS0xLjYxOSBjMy00LDEuMTItNy42MjEtNC40MzEtOC4wM2MtMC40NzgtMC4wMzYtMS4wNjctMC4xMDctMS42ODEtMC4xNjFjLTAuOTU5LDMuNDI3LTMuMjIyLDcuNjA0LTYuNDMzLDEyLjMyOSBjLTEuNDcxLDIuMTY2LTMuMDQ0LDQuMjk5LTQuNjE1LDYuM2MtMC41NTEsMC43MDUtMS4wNjIsMS4zNDQtMS41MjEsMS45MDVjLTAuMjQ2LDAuMzAyLTAuNDMyLDAuNTI0LTAuNTQ3LDAuNjYyIGMtMC4xMTgsMC4xNTMtMC4yNywwLjMyMS0wLjQ2NywwLjVDMTIuNzg3LDM5LjYsMTIuOCwzOS42LDEyLjcsMzkuNjY2aDAuMDE5VjM5Ljd6IiAvPg0KICAgIDxwYXRoIGNsYXNzPSJ3aGl0ZV9vcGFjaXR5IiBkPSJNMCwxMy41QzAsNiw2LDAsMTMuNSwwUzI3LDYsMjcsMTMuNWMwLDAuNzgyLTAuMDY2LDEuNTU3LTAuMTk4LDIuMzE3bDAuMDEzLDAuMTY2bC0wLjAzNywwLjIyOSBjLTAuNTk2LDMuNzAyLTMuMDUzLDguNDcyLTYuODAzLDE0Yy0xLjQ3MiwyLjE2Ni0zLjA0NSw0LjI5OS00LjYxNyw2LjMxYy0wLjU0OSwwLjcwNS0xLjA2MSwxLjM0NC0xLjUyMSwxLjkwNSBjLTAuMjQ2LDAuMzAyLTAuNDMzLDAuNTI0LTAuNTQ3LDAuN2MtMC4xMTgsMC4xNTMtMC4yNzEsMC4zMjEtMC40NjgsMC40OTVjLTAuMjIzLDAuMTk1LTAuNDYzLDAuMzYxLTAuNzI3LDAuNDgyIGMtMC40MDYsMC4xODctMC44NjUsMC4yNjQtMS40LDAuMmMtMC4xMTYtMC4wMjItMC4xNDgtMC4wMjgtMC4yMTctMC4wNDljLTAuODYzLTAuMjI2LTEuNDYzLTAuODgxLTEuNjYtMS42OCBjLTAuMTA2LTAuNDM0LTAuMDg4LTAuODE0LTAuMDA2LTEuMTgyYzAuMDE3LTAuMDcsMC4wMzItMC4xMzUsMC4wNTEtMC4xOTNsMi43Ny0xMC4yNThDNS4wNTksMjYsMCwyMC4zLDAsMTMuNUwwLDEzLjV6IiAvPg0KICAgIDxwYXRoIGNsYXNzPSJjdXN0b21fY29sb3Jfc29saWQiIGQ9Ik0yLDEzLjVDMiw3LjEsNy4xLDIsMTMuNSwyUzI1LDcuMSwyNSwxMy41YzAsMC43NjgtMC4wNzUsMS41MTctMC4yMTksMi4yYzAuMDEsMCwwLDAuMSwwLDAuMTUxIGMtMS4yODQsOC4wMDItMTMuMDgzLDIxLjk0OC0xMy4wODMsMjEuOTQ4cy0wLjM3NSwwLjUyMy0wLjczMiwwLjRjLTAuMzY3LTAuMDk0LTAuMjA0LTAuNTYyLTAuMjA0LTAuNTYybDMuNDMyLTEyLjcwOSBDMTMuOTc3LDI1LDEzLjcsMjUsMTMuNSwyNUM3LjE0OCwyNSwyLDE5LjksMiwxMy41TDIsMTMuNXoiIC8+DQogICAgPGNpcmNsZSBjbGFzcz0id2hpdGVfc29saWQiIGN4PSIxMy41IiBjeT0iMTMuNSIgcj0iOC41IiAvPg0KICA8L2c+DQogIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4LjAwMDAwMCwgMTAuMDAwMDAwKSI+DQogICAgPGxpbmVhckdyYWRpZW50IGlkPSJzaGFkb3ctZ3JhZGllbnQyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ii00NDAuOTU2NSIgeTE9IjcxLjY3MzgiIHgyPSItNDQwLjA1NjUiIHkyPSI3MC44NzM4IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDIxLjIxNjEgMCAwIDIxLjc4NzkgOTM2OC40ODgzIC0xNTI0LjUzMjIpIj4NCiAgICAgIDxzdG9wIG9mZnNldD0iMCIgY2xhc3M9ImJsYWNrX3NvbGlkX3N0YXJ0IiAvPg0KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBjbGFzcz0iYmxhY2tfc29saWRfZmluaXNoIiAvPg0KICAgIDwvbGluZWFyR3JhZGllbnQ+DQogICAgPHBhdGggY2xhc3M9InNoYWRvdyIgZmlsbD0idXJsKCNzaGFkb3ctZ3JhZGllbnQyKSIgZD0iTTEyLjcxOSwzOS43YzQuNzExLTIuMzk1LDE3LjgxOC0xMS41MTgsMTguMzA0LTExLjk3OWMwLjU1My0wLjUyMSwxLjA2Mi0xLjA2MiwxLjQ5LTEuNjE5IGMzLTQsMS4xMi03LjYyMS00LjQzMS04LjAzYy0wLjQ3OC0wLjAzNi0xLjA2Ny0wLjEwNy0xLjY4MS0wLjE2MWMtMC45NTksMy40MjctMy4yMjIsNy42MDQtNi40MzMsMTIuMzI5IGMtMS40NzEsMi4xNjYtMy4wNDQsNC4yOTktNC42MTUsNi4zYy0wLjU1MSwwLjcwNS0xLjA2MiwxLjM0NC0xLjUyMSwxLjkwNWMtMC4yNDYsMC4zMDItMC40MzIsMC41MjQtMC41NDcsMC42NjIgYy0wLjExOCwwLjE1My0wLjI3LDAuMzIxLTAuNDY3LDAuNUMxMi43ODcsMzkuNiwxMi44LDM5LjYsMTIuNywzOS42NjZoMC4wMTlWMzkuN3oiIC8+DQogICAgPHBhdGggY2xhc3M9IndoaXRlX29wYWNpdHkiIGQ9Ik0wLDEzLjVDMCw2LDYsMCwxMy41LDBTMjcsNiwyNywxMy41YzAsMC43ODItMC4wNjYsMS41NTctMC4xOTgsMi4zMTdsMC4wMTMsMC4xNjZsLTAuMDM3LDAuMjI5IGMtMC41OTYsMy43MDItMy4wNTMsOC40NzItNi44MDMsMTRjLTEuNDcyLDIuMTY2LTMuMDQ1LDQuMjk5LTQuNjE3LDYuMzFjLTAuNTQ5LDAuNzA1LTEuMDYxLDEuMzQ0LTEuNTIxLDEuOTA1IGMtMC4yNDYsMC4zMDItMC40MzMsMC41MjQtMC41NDcsMC43Yy0wLjExOCwwLjE1My0wLjI3MSwwLjMyMS0wLjQ2OCwwLjQ5NWMtMC4yMjMsMC4xOTUtMC40NjMsMC4zNjEtMC43MjcsMC40ODIgYy0wLjQwNiwwLjE4Ny0wLjg2NSwwLjI2NC0xLjQsMC4yYy0wLjExNi0wLjAyMi0wLjE0OC0wLjAyOC0wLjIxNy0wLjA0OWMtMC44NjMtMC4yMjYtMS40NjMtMC44ODEtMS42Ni0xLjY4IGMtMC4xMDYtMC40MzQtMC4wODgtMC44MTQtMC4wMDYtMS4xODJjMC4wMTctMC4wNywwLjAzMi0wLjEzNSwwLjA1MS0wLjE5M2wyLjc3LTEwLjI1OEM1LjA1OSwyNiwwLDIwLjMsMCwxMy41TDAsMTMuNXoiIC8+DQogICAgPHBhdGggY2xhc3M9ImN1c3RvbV9jb2xvcl9zb2xpZCIgZD0iTTIsMTMuNUMyLDcuMSw3LjEsMiwxMy41LDJTMjUsNy4xLDI1LDEzLjVjMCwwLjc2OC0wLjA3NSwxLjUxNy0wLjIxOSwyLjJjMC4wMSwwLDAsMC4xLDAsMC4xNTEgYy0xLjI4NCw4LjAwMi0xMy4wODMsMjEuOTQ4LTEzLjA4MywyMS45NDhzLTAuMzc1LDAuNTIzLTAuNzMyLDAuNGMtMC4zNjctMC4wOTQtMC4yMDQtMC41NjItMC4yMDQtMC41NjJsMy40MzItMTIuNzA5IEMxMy45NzcsMjUsMTMuNywyNSwxMy41LDI1QzcuMTQ4LDI1LDIsMTkuOSwyLDEzLjVMMiwxMy41eiIgLz4NCiAgICA8Y2lyY2xlIGNsYXNzPSJ3aGl0ZV9zb2xpZCIgY3g9IjEzLjUiIGN5PSIxMy41IiByPSI4LjUiIC8+DQogIDwvZz4NCjwvc3ZnPg==';
	var clustButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_clusters%',
			image: (clusters ? iconClustAP : iconScattAP)
		},
		options: {
			float: 'right'
		},
		state: {
			selected: clusters
		}
	});
	clustButton.events
		.add(
			'select',
			function () {
				settingsSetBool('3wifi.map.clusters', true);
				remoteObjectManager.setUrlTemplate(baseTileUrl);
				remoteObjectManager.reloadData();
				clustButton.data.set('image', iconClustAP);
			}
		)
		.add(
			'deselect',
			function () {
				settingsSetBool('3wifi.map.clusters', false);
				remoteObjectManager.setUrlTemplate(baseTileUrl + '&scat=1');
				remoteObjectManager.reloadData();
				clustButton.data.set('image', iconScattAP);
			}
		);
	myMap.controls.add(clustButton);

	// Кнопка перехода к диапазонам
	var rangesButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_ranges%',
			image: 'img/icon-ip.png'
		},
		options: {
			float: 'right',
			selectOnClick: false
		}
	});
	rangesButton.events
		.add(
			'click',
			function () {
				var coords = myMap.getCenter();
				var bounds = myMap.getBounds();
				var rad = ymaps.coordSystem.geo.getDistance(bounds[0], bounds[1]);
				rad = Math.ceil(((rad / 1000) / 2) * 10) / 10;
				var lat = Math.round(coords[0] * 10000000) / 10000000;
				var lon = Math.round(coords[1] * 10000000) / 10000000;
				if (rad > 25)
				{
					alert('%l10n_loc_large%');
					return false;
				}
				window.open('ranges?lat=' + lat + '&lon=' + lon + '&rad=' + rad, '_blank');
			}
		);
	myMap.controls.add(rangesButton);

	// Кнопка добавления локации в избранное
	var faveButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_favorite%',
			image: 'img/icon-fav-on.png'
		},
		options: {
			float: 'right',
			selectOnClick: false
		}
	});
	faveButton.events
		.add(
			'click',
			function () {
				var cmt = prompt("%l10n_loc_save%", '%l10n_loc_name%');
				if (cmt == null || cmt == '') return;
				var coords = myMap.getCenter();
				var onFail = function(jqXHR, textStatus, errorThrown)
				{
					alert('%l10n_err_data%');
				};
				$.get('user.php?a=token', function(json)
				{
					if (!json.result)
					{
						alert(errorStr(json.error));
						return;
					} else {
						var data = '';
						data += '&token=' + encodeURIComponent(json.token);
						data += '&lat=' + coords[0];
						data += '&lon=' + coords[1];
						data += '&cmt=' + cmt;
						$.get('user.php?a=addloc' + data, function(json)
						{
							if (!json.result)
							{
								alert(errorStr(json.error));
								return;
							}
							userLocations.reloadData();
							if (json.new)
							{
								alert('%l10n_loc_added%');
								return;
							}
							alert('%l10n_loc_updated%');
						}).fail(onFail);
					}
				}).fail(onFail);
			}
		);
	myMap.controls.add(faveButton);

	// Кнопка закрепления локации
	var lockButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_lock_coords%',
			image: 'img/icon-location.png'
		},
		options: {
			float: 'right',
			selectOnClick: false
		}
	});
	lockButton.events
		.add(
			'click',
			function () {
				if (ProfileInfo.Level < 1)
				{
					alert(errorStr('lowlevel'));
					return false;
				}
				var coords = myMap.getCenter();
				var bounds = myMap.getBounds();
				var rad = ymaps.coordSystem.geo.getDistance(bounds[0], bounds[1]);
				rad = Math.ceil(((rad / 1000) / 2) * 10) / 10;
				var lat = Math.round(coords[0] * 10000000) / 10000000;
				var lon = Math.round(coords[1] * 10000000) / 10000000;
				if (rad > 25)
				{
					alert('%l10n_loc_large%');
					return false;
				}
				document.cookie = 'uselocation=' + escape('lat=' + lat + '&lon=' + lon + '&rad=' + rad);
				if (getCookie('uselocation') != '')
				{
					alert('%l10n_loc_locked%');
				}
			}
		);
	myMap.controls.add(lockButton);

	// Кнопка сохранения точек в файл
	var iconSave = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNnB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNiAxNiIgd2lkdGg9IjE2cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZWZzLz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGlkPSJJY29ucyB3aXRoIG51bWJlcnMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIj48ZyBmaWxsPSIjMDAwMDAwIiBpZD0iR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03MjAuMDAwMDAwLCAtNDMyLjAwMDAwMCkiPjxwYXRoIGQ9Ik03MjEsNDQ2IEw3MzMsNDQ2IEw3MzMsNDQzIEw3MzUsNDQzIEw3MzUsNDQ2IEw3MzUsNDQ4IEw3MjEsNDQ4IFogTTcyMSw0NDMgTDcyMyw0NDMgTDcyMyw0NDYgTDcyMSw0NDYgWiBNNzI2LDQzMyBMNzMwLDQzMyBMNzMwLDQ0MCBMNzMyLDQ0MCBMNzI4LDQ0NSBMNzI0LDQ0MCBMNzI2LDQ0MCBaIE03MjYsNDMzIiBpZD0iUmVjdGFuZ2xlIDIxNyIvPjwvZz48L2c+PC9zdmc+';
	var saveButton = new ymaps.control.Button({
		data: {
			title: '%l10n_map_aps_save%',
			image: iconSave
		},
		options: {
			float: 'right'
		}
	});
	saveButton.events.add('click', function ()
	{
		var points = [];
		var element = document.createElement('div'); // to convert special html chars
		remoteObjectManager.objects.each(function (el)
		{
			//if (!remoteObjectManager.getObjectState(el.id).isShown) { return; }
			var lat = el.geometry.coordinates[0];
			var lon = el.geometry.coordinates[1];
			var hints = el.properties.hintContent.split('<hr>');
			for (var i = 0, l = hints.length; i < l; i++)
			{
				element.innerHTML = hints[i].split('<br>').slice(1).concat([lat, lon]).join("\t") + "\r\n";
				hints[i] = element.textContent;
				element.textContent = '';
			}
			points = points.concat(hints);
		});
		var blob = new Blob(points, {type: 'text/plain; charset=utf-8'});
		saveAs(blob, '');
	});
	myMap.controls.add(saveButton, {float: 'right', selectOnClick: false});
}
function loginConfirm()
{
	if (!confirm("%l10n_msg_map_reveal%")) return;

	loginBtn(true);
}
function refreshLocation()
{
	var coords = myMap.getCenter();
	var lat = Math.round(coords[0] * 10000000) / 10000000;
	var lon = Math.round(coords[1] * 10000000) / 10000000;
	window.location = "?lat=" + lat + "&lon=" + lon;
}
function initpage()
{
	ymaps.ready(initmap);	
}
</script>
<style>
ymaps.ymaps-2-1-48-hint__text
{
	max-height: 350px;
	overflow-y: auto;
}
</style>
</head>

<body>
<div id=map style="width: 100%; height: 100%"></div>
</body>